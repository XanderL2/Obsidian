
---
### Manejo de Errores en WebSockets

```typescript
import { WebSocketGateway, WebSocketServer, SubscribeMessage, MessageBody, ConnectedSocket } from '@nestjs/websockets';
import { Server, Socket } from 'socket.io';

@WebSocketGateway()
export class MessagesGateway {
  @WebSocketServer()
  server: Server;

  @SubscribeMessage('sendMessage')
  async handleMessage(@MessageBody() data: any, @ConnectedSocket() client: Socket): Promise<void> {
    try {
      // Validar datos y realizar lógica
      if (!data.userId) {
        throw new Error('User ID is required.');
      }

      // Aquí se puede realizar la lógica de la API para obtener la información del usuario
      const userInfo = await this.getUserInfo(data.userId);

      if (!userInfo) {
        throw new Error('User not found.');
      }

      // Si todo está bien, envía una respuesta positiva
      client.emit('messageResponse', { success: true, message: 'Message processed successfully.' });
    } catch (error) {
      // Envía un mensaje de error estructurado al cliente
      client.emit('error', { errorCode: 'INVALID_REQUEST', message: error.message });
    }
  }
}

```